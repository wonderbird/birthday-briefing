# Progress ‚Äì Birthday Briefing

## Current Status

- Discovery and vision:
  - The core user problem and emotional drivers are clearly articulated.
  - The primary value proposition and positioning as a privacy-first, calm birthday overview are defined.
- V1 scope:
  - A 14-day view anchored to the first day of the current week (Monday or Sunday, user-configurable) has been chosen.
  - The app is intentionally limited to short-term planning and does not provide notifications.
- **CRITICAL BLOCKER DISCOVERED (Dec 2025)**:
  - ‚ùå Browser CORS policy blocks CardDAV access from web applications
  - Implementation complete and tested, but non-functional in browser
  - Architectural redesign required (see Next Milestones section)
  - Product decision needed: privacy vs. functionality trade-off
- Documentation:
  - Complete memory bank established: `projectbrief.md`, `productContext.md`, `activeContext.md`, `systemPatterns.md`, `techContext.md`, and `progress.md`.
  - All documentation correctly uses CardDAV (address book protocol) for birthday data access.
  - **ADR 001**: Hybrid Testing Strategy (MSW + Docker/Radicale) documented and approved.
  - **ADR 002**: CardDAV Client Library (`tsdav`) approved.
- Implementation progressing:
  - React 19.1 project initialized with Vite build tooling.
  - Bootstrap 5.3.2 integrated for UI styling.
  - First-time setup screen implemented with form and navigation.
  - Main screen with 14-day birthday view implemented.
  - Component structure established under `src/components/`.
  - App-level state management for view navigation.
- Deployment infrastructure:
  - GitHub Actions workflow for automated FTPS deployment.
  - Deploys to demo.boos.systems on push to main or manual trigger.
  - Uses Node.js 24.x (LTS - Krypton) for builds.
  - Includes dangerous-clean-slate troubleshooting option for deployment issues.
  - Documentation added to README.md for deployment setup and troubleshooting.
- Development workflow and quality:
  - Clean code rules established in `.cursor/rules/clean-code/`.
  - TDD workflow, mutation testing guidelines, and pre-commit checks defined.
  - MIT License file properly added to repository.
  - Workflow orchestrator defines pre-commit process (tests, mutation tests, memory bank update).
  - **Rule clarification (Jan 2025)**: Updated workflow orchestrator to be language-agnostic and integrated with TDD cycle.
- Testing infrastructure (completed):
  - Vitest configured with jsdom environment and HTML coverage reporting
  - Stryker Mutator configured with JSON and HTML reporters
  - Test scripts available: test, test:watch, test:ui, test:coverage, test:mutate
  - Initial test suite created with 14 tests for date utility functions
  - Baseline metrics established: 100% code coverage, 90.48% mutation score
  - Date utility functions extracted to src/utils/dateUtils.js for testability
  - Ready for TDD workflow (red-green-refactor cycles)
  - **New**: Mock Service Worker (MSW) integration completed.
  - **New**: Integration test for CardDAV fetching implemented.
- Configuration persistence (completed):
  - Storage module implemented: validateConfig, saveConfig, loadConfig, clearConfig, isConfigured
  - Data structure: carddavUrl and firstDayOfWeek stored in 'birthday-briefing-config' key
  - FirstTimeSetup integration: form state management and saveConfig calls
  - App.jsx integration: isConfigured check, conditional rendering, config passed to MainScreen
  - 6 git commits following strict TDD (red-green-refactor cycles)
  - All code review checks passed
- Configuration editing support (completed):
  - FirstTimeSetup accepts optional initialConfig prop for editing mode
  - App passes loaded config to FirstTimeSetup when editing
  - App reloads config from storage after save to update state
  - 44 tests passing (20 storage, 5 FirstTimeSetup, 5 App, 14 dateUtils)
  - Mutation score: 83.50% overall (storage: 78.69%, dateUtils: 90.48%)
  - 5 git commits following strict TDD (red-green-refactor cycles)
  - All code review checks passed
- CardDAV Testing Infrastructure (completed):
  - **Mock Server**: MSW installed and configured (`src/mocks/`).
  - **Test Data**: vCard fixtures created (`src/test/fixtures/`).
  - **Factories**: XML response factory implemented (`src/test/factories/`).
  - **Integration Test**: Validated data fetching (`src/test/integration/`).
  - **Metrics**: 49 tests passing (100%). Mutation score ~78% (infrastructure code excluded/not covered).
  - **PoC Script**: Standalone proof of concept (`scripts/poc-carddav.js`) created and verified.
- CardDAV authentication strategy (decided):
  - **Decision**: Session-based credentials (sessionStorage)
  - **Rationale**: Balance between privacy (cleared on browser close) and UX (once per session)
  - **Implementation Plan**: Extend FirstTimeSetup with username/password fields, use sessionStorage for credentials
  - **Alternative approaches evaluated**: URL-embedded credentials, prompt every time, OAuth/tokens

## Key Achievements So Far

- Defined the product promise:
  - "With this app, I will be sure to remember your birthday."
- Clarified:
  - Target users and their planning context.
  - The importance of privacy and calm, user-initiated usage.
  - The decision to use a 14-day, week-anchored view instead of a simple weekly-only view.
- Established complete memory bank documentation:
  - All core files created and aligned with project vision.
  - Corrected protocol from CalDAV to CardDAV throughout project.
- Implemented core UI components:
  - Created `FirstTimeSetup.jsx` - minimal, single-screen configuration form.
  - Created `MainScreen.jsx` - 14-day birthday view with hardcoded data.
  - Added settings navigation - gear icon button returns to configuration screen.
  - Integrated Bootstrap 5.3.2 for consistent, responsive styling.
  - Established UI design direction: clean, centered, card-based layouts.
- Made key technical decisions:
  - React 19.1 with Vite for development.
  - Bootstrap for UI framework (default theme via CDN).
  - Component-based architecture with separation of concerns.
  - **Testing**: Hybrid Strategy (MSW for speed, Docker/Radicale for reliability) per ADR 001.
- Made key UX decisions for birthday view:
  - Continuous list layout (not blocks or grid).
  - Birthday-only days (not full 14-day timeline).
  - Color-coded visual distinction (gray/past, blue-bold/today, default/future).
  - Short date format "Mon, Nov 25".
  - Comma-separated names for multiple birthdays on same day.
- Established deployment infrastructure:
  - GitHub Actions workflow for continuous deployment via FTPS.
  - Automated builds using Node.js 24.x (latest LTS).
  - Secure credential management through GitHub Secrets.
  - Live deployment target: demo.boos.systems.
  - Deployment troubleshooting with dangerous-clean-slate option.
  - Comprehensive deployment documentation in README.md.
- Established development workflow and quality standards:
  - Clean code rules implemented following TDD principles.
  - Mutation testing guidelines established.
  - Pre-commit workflow orchestrator defined (tests ‚Üí mutation tests ‚Üí memory bank ‚Üí commit).
  - MIT License formally added to repository.
  - Development principles and practices documented for consistency.
  - **Rule clarification completed**: Made workflow orchestrator language-agnostic and explicitly integrated with TDD cycle.
  - Pre-commit workflow now explicitly applies to every commit including TDD red/green/refactor steps.
- Implemented comprehensive testing infrastructure:
  - Vitest unit testing framework with jsdom for React component testing.
  - Stryker Mutator for mutation testing to ensure test quality.
  - Test coverage: 100% on dateUtils.js with HTML reports.
  - Mutation score: 90.48% baseline established (38/42 mutants killed).
  - Date utility functions extracted and thoroughly tested (14 test cases).
  - Testing conventions documented for consistent approach.
  - All test scripts integrated and verified working.
  - Test strategy documented in docs/test-strategy.md (69 lines):
    - Concise reference document for senior developers
    - Test pyramid structure (60% unit, 30% integration, 10% E2E)
    - Hybrid testing approach (MSW for speed, Docker for reliability)
    - Quality targets (>80% coverage, >75% mutation score)
    - References to config files and ADRs (avoids duplication)
    - Key principles and privacy guidelines
- Implemented configuration persistence with full UI integration:
  - Created storage module with 5 functions (validate, save, load, clear, isConfigured).
  - Integrated FirstTimeSetup: captures form data, calls saveConfig, passes config to parent.
  - Integrated App.jsx: detects config on mount, conditionally renders views, passes config to MainScreen.
  - Implemented using strict TDD: 6 commits following red-green-refactor cycles.
  - Configuration now persists across browser sessions using localStorage.
- Implemented configuration editing support:
  - FirstTimeSetup accepts optional initialConfig prop for pre-populating form fields.
  - Form works in both modes: initial setup (empty values) and edit mode (pre-populated values).
  - App passes loaded config to FirstTimeSetup when user clicks settings gear icon.
  - App reloads config from storage after save to keep state synchronized.
  - Implemented using strict TDD: 5 commits following red-green-refactor cycles.
  - Achieved 44 passing tests with 83.50% mutation score.
  - All code complies with clean code rules and git conventions.
- **CardDAV Testing Infrastructure**:
  - ADR 001 revised and approved: Hybrid Strategy (MSW + Docker/Radicale).
  - MSW successfully implemented for fast integration tests.
  - Created reusable XML response factories to ensure valid CardDAV data in tests.
  - Verified integration with working fetch test case.
  - E2E infrastructure pending: Docker compose file and E2E test suite.
- **CardDAV Proof of Concept**:
  - Created standalone Node.js script (`scripts/poc-carddav.js`) using `tsdav` library.
  - Successfully connected to real CardDAV server and fetched contacts.
  - Parsed vCard data to extract names and birthdays.
  - Implemented environment variable-based credential management (`.envrc` for `direnv`).
  - Validated authentication flow and data retrieval patterns.
- **Authentication Strategy Decision**:
  - Evaluated three approaches: session-based, URL-embedded, and prompt-every-time.
  - Selected session-based credentials (sessionStorage) for balance of privacy and UX.
  - Planned implementation: extend FirstTimeSetup with username/password fields with clear privacy messaging.
- **Authentication Integration**:
  - Extended storage module with 4 credential functions (save, load, clear, hasCredentials).
  - Added username and password input fields to FirstTimeSetup component.
  - Implemented privacy help text explaining session-based storage.
  - Integrated credential storage with form save handler.
  - Achieved 80.25% mutation score on storage.js (exceeds >75% target).
  - 60 tests passing (27 storage, 9 FirstTimeSetup, 14 dateUtils, 5 App, 3 xmlFactory, 1 integration, 1 vcard).
  - Followed strict TDD with 8 commits (red-green-refactor cycles).
  - All code compliant with clean code rules.
- **CardDAV Client Module & UI Integration** (Completed):
  - Created module structure: `src/services/carddavClient.js` and test file.
  - Implemented `fetchBirthdays()` function with CardDAV connection, vCard parsing, and 14-day filtering.
  - Uses tsdav's DAVClient for CardDAV protocol communication.
  - Parses FN (full name) and BDAY (birthday) fields from vCard data using regex.
  - Supports --MM-DD and YYYY-MM-DD birthday formats.
  - Filters birthdays to 14-day window from start of current week.
  - Accepts firstDayOfWeek parameter ('monday' or 'sunday') for week calculation.
  - Unit tests use mocked tsdav client for fast, isolated testing.
  - **MainScreen Integration**:
    - Replaced hardcoded birthday data with CardDAV fetching via useEffect.
    - Loads config and credentials from storage on component mount.
    - Transforms data format and groups birthdays by date.
    - Implements loading, error, and empty states.
    - Created MainScreen.test.jsx with component-level integration test.
  - Test results: 64 tests passing (9 test files).
  - Mutation score: 76.40% overall (carddavClient: 68.75%, dateUtils: 90.48%, storage: 80.25%).
  - Followed strict TDD with RED-GREEN cycles and commits.
  - Documented constraint: Stryker requires all tests passing, so RED commits skip mutation tests.
  - **End-to-end CardDAV integration complete**: App now fetches and displays real birthday data from CardDAV servers.

## Assumptions and Risks

- Assumptions:
  - Users can access or obtain a valid CardDAV URL for their birthday data.
  - Weekly or short-term planning checks (without notifications) are sufficient for many users to feel safe about remembering birthdays.
  - Users are willing to use a dedicated birthday tool alongside their main calendar.
  - A birthday-only days list will feel faster to read than a full 14-day timeline, because it contains less information.
  - Bootstrap's default styling will provide a clean, professional appearance without extensive custom CSS.
  - Browser localStorage is available in most user environments (5-10MB per origin is sufficient for configuration data).
  - ~~Users will accept that private/incognito browsing mode requires reconfiguration each session (configuration not persisted).~~
  - ~~Browser-based web apps can directly access CardDAV servers~~ **INVALIDATED: CORS blocks this**
- Risks:
  - CardDAV configuration may be too technical or confusing for some users.
  - If birthdays are not reliably stored in the underlying address book or contacts, the 14-day view may appear incomplete or misleading.
  - Without notifications, some users may forget to open the app regularly, reducing its impact.
  - Users in private/incognito mode will have degraded experience (no persistence across sessions).
  - Storing CardDAV URLs with embedded credentials in localStorage could be exploited via XSS attacks (mitigated by React's built-in XSS protection).
  - Browser storage could become corrupted, requiring clear error messages and recovery path to FirstTimeSetup.
  - **MATERIALIZED RISK - CRITICAL**: Browser CORS policy blocks direct CardDAV access from web apps
    - CardDAV servers don't send CORS headers (designed for native apps, not browsers)
    - Redirect responses in CORS preflight fail per specification
    - Current "browser-based web app" architecture incompatible with security model
    - Requires architectural redesign: backend proxy, browser extension, or native app
    - Privacy promise ("no server-side storage") conflicts with technical requirements

## Next Milestones

- **Completed** (CardDAV Client Implementation):
  - ‚úÖ ADR 001: Hybrid Testing Strategy (MSW + Docker/Radicale)
  - ‚úÖ ADR 002: CardDAV Client Library (`tsdav`)
  - ‚úÖ MSW mock server and test infrastructure
  - ‚úÖ PoC script validated with real CardDAV server
  - ‚úÖ Authentication strategy: session-based credentials
  - ‚úÖ `tsdav` installed as production dependency
  - ‚úÖ CardDAV client with connection, parsing, and 14-day filtering
  - ‚úÖ MainScreen integration with async data loading
  - ‚úÖ Comprehensive test coverage (64 tests, 76.40% mutation score)
  - ‚úÖ All code compliant with TDD workflow and rules
  - ‚ùå **BLOCKED IN BROWSER**: CORS policy prevents CardDAV access

- **IMMEDIATE PRIORITY** (Architecture Decision - CORS Solution):
  - üî¥ **CRITICAL**: Research CORS solutions for browser-based CardDAV access
  - Create ADR 003: CORS Solution Strategy
  - Options to evaluate:
    1. Backend proxy server (privacy trade-off)
    2. Browser extension (platform change)
    3. Native app - Electron/Tauri (not web app)
    4. CORS proxy service (third-party privacy risk)
    5. Server-side CardDAV fetching with API
    6. Document limitation (CORS-enabled servers only)
  - Analyze each option:
    - Privacy implications
    - Architectural complexity
    - User experience impact
    - Deployment requirements
    - Maintenance burden
  - Product decision required: privacy vs. functionality trade-off
  - Implementation plan based on chosen solution

- **DEFERRED** (Until architecture decided):
  - E2E Docker infrastructure (compose.yaml, E2E tests)
  - Data synchronization and caching layer
  - Background refresh mechanisms
  - Performance optimization
  - Additional error handling scenarios
  - Settings screen enhancements
  - User testing with live deployment

## Memory Bank and Documentation Practices

- `activeContext.md` and this `progress.md` will be updated when:
  - New decisions are made about layout, onboarding, privacy messaging, or configuration behavior.
  - Significant implementation steps are completed or new risks and assumptions are identified.
- All memory bank files will be reviewed regularly to:
  - Keep them aligned with the actual state of the project.
  - Avoid duplication by referencing higher-level documents where appropriate.
  - Ensure that a future agent can understand the project and continue working effectively based solely on these files.
